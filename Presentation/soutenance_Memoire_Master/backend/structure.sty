%--------------------------------------
%  Inner Theme Settings
%--------------------------------------

\newcommand{\pngangle}{img/theme/angle.png}
\pgfdeclareimage[height=2ex]{Angle}{\pngangle}
\newcommand{\anglepng}{\pgfuseimage{Angle}}

\newlength{\angleheight}
\settoheight{\angleheight}{\pgfuseimage{Angle}}
\newlength{\anglewidth}
\settowidth{\anglewidth}{\pgfuseimage{Angle}}
\newlength{\titleH}

\newlength\vmargin
\setlength\vmargin{.07\paperheight}
\newlength\hmargin
\setlength\hmargin{.05\paperwidth}

\newlength\fullpageinnerhmargin
\setlength\fullpageinnerhmargin{\dimexpr\hmargin+2\anglewidth}

\setbeamersize{%
  text margin left = \fullpageinnerhmargin,
  text margin right = \fullpageinnerhmargin,
}

\pgfdeclareverticalshading[lower.bg,upper.bg]{bmb@transition}{200cm}{%
color(0pt)=(lower.bg); color(2pt)=(lower.bg); color(4pt)=(lower.bg)}


\setbeamertemplate{navigation symbols}{}

\setbeamertemplate{blocks}[rounded][shadow=true]

\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{enumerate subitem}[default]
\setbeamertemplate{itemize items}[circle]
\setbeamertemplate{itemize subitem}[circle]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%               SUMMARY
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}{%
    \leavevmode
    \leftskip=3.2em
    \rlap{\hskip-2em\inserttocsectionnumber.\inserttocsubsectionnumber}
    \inserttocsubsection\par
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       TITLE PAGE
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{title page}{
    \thispagestyle{empty}
    \vspace*{-1cm}
    \begin{figure}
        \includegraphics[scale = 0.5]{img/theme/RF-INria_Bloc-marque.png}
        \hfill
        \includegraphics[width=0.09\linewidth]{img/theme/LOGO_CEA_ORIGINAL_2022.png}
        \hfill
        \includegraphics[width=0.2\linewidth]{img/theme/ub-logo.png}
    \end{figure}
    \vfill
    % ------------------------
    \begin{beamercolorbox}[sep=10pt,shadow=true,rounded=true]{title}
        \usebeamerfont{title}\inserttitle\par%
        \includegraphics[scale = 0.5, width = 100pt]{img/theme/ligne2.png}\\
        \usebeamerfont{subtitle}\insertsubtitle\par%
    \end{beamercolorbox}%
    \vfill
    % ------------------------
    \begin{beamercolorbox}[sep=10pt]{author}
        \usebeamerfont{author}\authors
    \end{beamercolorbox}
    \vfill
    % ------------------------
    \begin{beamercolorbox}[sep=8pt]{institute}
        \usebeamerfont{institute}\uni
    \end{beamercolorbox}
    \vspace*{-1cm}
    \begin{tikzpicture}[overlay]
      \node at ([yshift=-1cm, xshift=-1.5cm]current page.south) {\includegraphics[scale =0.1]{img/cc-by-nc-sa.pdf}};
  \end{tikzpicture}
    
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%      HEADLINE
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\useoutertheme[subsection=false]{smoothbars}

\setbeamertemplate{headline}{
    
    \begin{beamercolorbox}{section in head/foot}
        \vskip1.5pt\insertsectionnavigationhorizontal{\paperwidth}{\hfill}{\hfill}\vskip3pt
    \end{beamercolorbox}

    \begin{beamercolorbox}[colsep=4pt]{upper separation line head}
    \end{beamercolorbox}
    
    
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%           FOOTLINE
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\setbeamertemplate{footline}[frame number]


\makeatletter % [add curpage/total page at the bottom](http://tex.stackexchange.com/questions/100838/beamer-dresden-theme-miniframes-appeareance-and-frame-number-insertion)
\newcommand{\frameofframes}{/}
\newcommand{\setframeofframes}[1]{\renewcommand{\frameofframes}{#1}}

\setbeamertemplate{footline} {
    \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    \end{beamercolorbox}

    \begin{beamercolorbox}[ht=3ex,dp=1.5ex,%
        leftskip=.5cm,rightskip=.5cm ]{title in head/foot}%
        {\usebeamerfont{author in head/foot}\ajd}%
        \hfill
        \includegraphics[height=2.5ex]{img/theme/Inria-logo-rouge.png}
        \hspace{50pt}
        \includegraphics[height=2.5ex]{img/theme/LOGO_CEA_ORIGINAL_2022.png}
        \hspace{50pt}
        \includegraphics[height=3ex]{img/theme/ub-logo.png}
        \hfill
        {\usebeamerfont{frame number}\usebeamercolor[fg]{frame number}\insertframenumber~\frameofframes~\inserttotalframenumber}
    \end{beamercolorbox}
    
   \begin{beamercolorbox}[wd=\paperwidth,ht=3pt,dp=-1pt,leftskip=-1pt,rightskip=-1pt]{progressbar}
    \progressbar
\end{beamercolorbox}
    
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%        Sommaire
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{section in toc}{%
  \leavevmode
  \textcolor{black}{\textbf{\inserttocsectionnumber.~\inserttocsection}}%
  \vskip0.4ex 
}

\setbeamertemplate{subsection in toc}{%
  \leavevmode
  \hspace*{2.5em}
  \inserttocsubsectionnumber.~\inserttocsubsection%
  \vskip0.2ex
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Transition entre sections
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\AtBeginSection[]{
  \ifshowtoc
    \begin{frame}
    \begin{center}
        \textbf{\huge%
          \padzeroes[2]{\decimal{section}} \\[1ex]
          \insertsection} \\[1ex]
          {\includegraphics{img/theme/ligne2.png}}
    \end{center}
    \end{frame}
  \fi
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Formatage des titres
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\defbeamertemplate*{frametitle}{inria}[1][]{%
    % textblock 
    \begin{textblock*}{\anglewidth}(\hmargin,\vmargin)
        \anglepng
    \end{textblock*}
    \begin{textblock*}{\textwidth}(\hmargin+\anglewidth,\vmargin+\angleheight)
        \textbf{\LARGE \insertframetitle}
    \end{textblock*}

    \settoheight{\titleH}{\insertframetitle}
    \addtolength{\titleH}{\angleheight}
    \vspace*{2\titleH}
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Equation bloc et les autres
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newlength\mytemplen
\newsavebox\mytempbox

\makeatletter
\newcommand\equations{%
    \@ifnextchar[%]
       {\@equations}%
       {\@equations[0pt]}}

\def\@equations[#1]{%
    \@ifnextchar[%]
       {\@@equations[#1]}%
       {\@@equations[#1][0pt]}}

\def\@@equations[#1][#2]#3{
    \sbox\mytempbox{#3}%
    \mytemplen\ht\mytempbox
    \advance\mytemplen #1\relax
    \ht\mytempbox\mytemplen
    \mytemplen\dp\mytempbox
    \advance\mytemplen #2\relax
    \dp\mytempbox\mytemplen
    \colorbox{eq_blue}{\hspace{1em}\usebox{\mytempbox}\hspace{1em}}}

\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Blocks
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\addtobeamertemplate{block begin}{}{\justifying}
\addtobeamertemplate{block alerted begin}{}{\justifying}
\addtobeamertemplate{block example begin}{}{\justifying}

\newenvironment{blockSimple}[1]{%
  \par\vskip\medskipamount%
  \begin{beamercolorbox}[leftskip=0.5em, rightskip=0.5em]{normal text}%
    \textbf{#1}\par\smallskip%
}{%
  \end{beamercolorbox}%
  \vskip\medskipamount%
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Minted
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setminted{
    frame=single, % Encadrement simple
    breaklines, % Couper les lignes trop longues
    fontsize=\scriptsize, % Taille de la police
    tabsize=4 % Taille des tabulations
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       caption spec
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{caption}{%
  \insertcaption\par
}