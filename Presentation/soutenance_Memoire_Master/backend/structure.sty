%--------------------------------------
%  Inner Theme Settings
%--------------------------------------

\pgfdeclareverticalshading[lower.bg,upper.bg]{bmb@transition}{200cm}{%
color(0pt)=(lower.bg); color(2pt)=(lower.bg); color(4pt)=(lower.bg)}

\setbeamersize{text margin left=2em,text margin right=2em}


\setbeamertemplate{navigation symbols}{}

\setbeamertemplate{blocks}[rounded][shadow=true]

\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{enumerate subitem}[default]
\setbeamertemplate{itemize items}[circle]
\setbeamertemplate{itemize subitem}[circle]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%               SUMMARY
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}{%
    \leavevmode
    \leftskip=3.2em
    \rlap{\hskip-2em\inserttocsectionnumber.\inserttocsubsectionnumber}
    \inserttocsubsection\par
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       TITLE PAGE
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{title page}{
    \thispagestyle{empty}
    \vfill
    \begingroup
    \centering
    % ------------------------
    \begin{beamercolorbox}[sep=10pt,center,shadow=true,rounded=true]{title}
        \usebeamerfont{title}\inserttitle\par%
    \end{beamercolorbox}%
    \vfill
    % ------------------------
    \begin{beamercolorbox}[sep=8pt,center]{author}
        \usebeamerfont{author}\authors
    \end{beamercolorbox}
    \vfill
    % ------------------------
    \begin{beamercolorbox}[sep=8pt,center]{institute}
        \usebeamerfont{institute}\uni
    \end{beamercolorbox}
    \endgroup
    \vfill
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%           FOOTLINE
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\setbeamertemplate{footline}[frame number]


\makeatletter % [add curpage/total page at the bottom](http://tex.stackexchange.com/questions/100838/beamer-dresden-theme-miniframes-appeareance-and-frame-number-insertion)
\newcommand{\frameofframes}{/}
\newcommand{\setframeofframes}[1]{\renewcommand{\frameofframes}{#1}}

\setbeamertemplate{footline} {
    % display a line
    % \begin{beamercolorbox}[colsep=1.5pt]{upper separation line foot}
    % \end{beamercolorbox}
    
    % second line
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,%
      leftskip=.3cm,rightskip=.3cm ]{title in head/foot}%
      {\usebeamerfont{author in head/foot}\author}%
      \hfill%
      {\usebeamerfont{frame number}\usebeamercolor[fg]{frame number}\insertframenumber~\frameofframes~\inserttotalframenumber}
    \end{beamercolorbox}

    % thrid line
    \begin{beamercolorbox}[ht=2.5ex,dp=1.125ex,leftskip=.3cm,rightskip=.3cm ]{author in head/foot}
      \leavevmode{\usebeamerfont{title in head/foot}\insertshorttitle}
      \hfill
     {\usebeamerfont{institute in head/foot}\usebeamercolor[fg]{institute in head/foot}\insertshortinstitute}
    \end{beamercolorbox}
    
    % \begin{beamercolorbox}[colsep=2pt]{upper separation line foot}
    % \end{beamercolorbox}
    % \progressbar
    
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Barre de progression en haut
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\useoutertheme[subsection=false]{smoothbars}

\setbeamertemplate{headline}{
    
    \begin{beamercolorbox}{section in head/foot}
        \vskip1.5pt\insertsectionnavigationhorizontal{\paperwidth}{\hfill}{\hfill}\vskip3pt
    \end{beamercolorbox}
    \progressbar
    \begin{beamercolorbox}[colsep=4pt]{upper separation line head}
    \end{beamercolorbox}
    
    
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Transition entre sections
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\AtBeginSection[]{
  \ifshowtoc
    \begin{frame}
    \begin{center}
        \usebeamercolor[fg]{section title}
        \huge \insertsection
    \end{center}
    \end{frame}
  \fi
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Equation bloc
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newlength\mytemplen
\newsavebox\mytempbox

\makeatletter
\newcommand\equations{%
    \@ifnextchar[%]
       {\@equations}%
       {\@equations[0pt]}}

\def\@equations[#1]{%
    \@ifnextchar[%]
       {\@@equations[#1]}%
       {\@@equations[#1][0pt]}}

\def\@@equations[#1][#2]#3{
    \sbox\mytempbox{#3}%
    \mytemplen\ht\mytempbox
    \advance\mytemplen #1\relax
    \ht\mytempbox\mytemplen
    \mytemplen\dp\mytempbox
    \advance\mytemplen #2\relax
    \dp\mytempbox\mytemplen
    \colorbox{eq_blue}{\hspace{1em}\usebox{\mytempbox}\hspace{1em}}}

\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       Minted
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setminted{
    frame=single, % Encadrement simple
    breaklines, % Couper les lignes trop longues
    fontsize=\scriptsize, % Taille de la police
    tabsize=4 % Taille des tabulations
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%       caption spec
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setbeamertemplate{caption}{%
  \insertcaption\par
}